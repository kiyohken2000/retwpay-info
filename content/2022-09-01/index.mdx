---
title: Expoã®ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã™ã‚‹
tags: [    ]
date: 2022-09-01
path: blog/2022-09-01
cover: ./img.png
excerpt: Sending Notifications with Expo's Push API
keywords:
  - é–‹ç™º
  - ã‚³ãƒ¼ãƒ‰
  - code
  - react native
  - expo
---
import { Link } from 'gatsby';

## Expo's Push API

<Link to="/blog/2021-04-08">ä»¥å‰</Link>ã«Firebase Cloud Functionsã‚’åˆ©ç”¨ã—ã¦Expoã‚¢ãƒ—ãƒªã«ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹æ–¹æ³•ã‚’æ›¸ãã¾ã—ãŸã€‚

ä»Šå›ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ(ã‚¢ãƒ—ãƒª)ã‹ã‚‰ç›´æ¥Expo's Push APIã‚’åˆ©ç”¨ã—ã¦é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚

## ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®é€ä¿¡æ–¹æ³•

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.expo.dev/push-notifications/sending-notifications/#http2-api)ã®é€šã‚Šã§ã™ã€‚

ExpoãŒç”¨æ„ã—ã¦ã„ã‚‹ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ(`https://exp.host/--/api/v2/push/send`)ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚

ã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè£…ã—ãŸã¨ãã¯SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã™ã‚‹å ´åˆã¯ä¸è¦ã§ã™ã€‚

![](./img1.jpg)

curlã®å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```
curl -H "Content-Type: application/json" -X POST "https://exp.host/--/api/v2/push/send" -d '{
  "to": "ExponentPushToken[xxxxxxxxxxxxxxxxxxxxxx]",
  "title":"hello",
  "body": "world"
}'
```

ã“ã‚Œã‚’Javascriptç”¨ã«æ›¸ãæ›ãˆã¾ã™ã€‚

## å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰

ä»Šå›ã¯axiosã‚’ä½¿ã£ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“Fetch APIã‚’åˆ©ç”¨ã—ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

ã‚¢ãƒ—ãƒªå†…ã®è‰²ã€…ãªå ´æ‰€ã‹ã‚‰å‘¼ã¹ã‚‹ã‚ˆã†ã«é–¢æ•°åŒ–ã—ã¦ãŠãã¾ã™ã€‚

**src\utils\SendNotification.js**

```javascript
import axios from "axios";

const sendNotification = async({title, body, token, data}) => {
  const response = await axios.post(
    'https://exp.host/--/api/v2/push/send',
    {
      'to': token,
      'title': title,
      'body': body,
      'data': { data }
    },
    {headers: {'Content-Type': 'application/json'}}
  )
  const { status } = response
  return status
}

export { sendNotification }
```

é€šçŸ¥ã‚’é€ä¿¡ã—ãŸã„ã¨ãã«ä¸Šã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```javascript
const onNotificationPress = async() => {
  const res = await sendNotification({
    title: 'Hello',
    body: 'This is some something ğŸ‘‹',
    data: 'something data',
    token: token //e.g. ExponentPushToken[WGSdXiJ5rLHAK53DRPq2x-]
  })
  console.log(res)
}
```

`TouchableOpacity`ã‚„`Button`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãªã©ã®`onPress`ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰`onNotificationPress`ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```javascript
<Button
  label='Send Notification'
  onPress={() => onNotificationPress()}
/>
```

## ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãƒªã‚¹ãƒŠãƒ¼

ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’å—ä¿¡ã—ãŸã“ã¨ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã—ã¦ä½•ã‚‰ã‹ã®å‡¦ç†ã‚’ã—ãŸã„å ´åˆã¯ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒªã‚¹ãƒŠãƒ¼ã‚’å®Ÿè¡Œã—ã¦ãŠãã¾ã™ã€‚

ä»¥ä¸‹ã®ä¾‹ã§ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«é€šçŸ¥å†…å®¹ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚

```javascript
useEffect(() => {
  const subscription = Notifications.addNotificationReceivedListener(notification => {
    console.log(notification.request.content)
  });
  return () => subscription.remove();
}, []);
```

ä¸Šã«æ›¸ã„ãŸãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’å—ä¿¡ã™ã‚‹ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
Object {
  "attachments": Array [],
  "badge": null,
  "body": "This is some something ğŸ‘‹",
  "categoryIdentifier": "",
  "data": Object {
    "data": "something data",
  },
  "launchImageName": "",
  "sound": null,
  "subtitle": null,
  "summaryArgument": null,
  "summaryArgumentCount": 0,
  "targetContentIdentifier": null,
  "threadIdentifier": "",
  "title": "Hello",
}
```

## ã¾ã¨ã‚

Expoã®Push APIã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚‚ç°¡å˜ã«é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

å…¨ã‚³ãƒ¼ãƒ‰ã¯[è‡ªä½œãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ](https://github.com/kiyohken2000/ReactNative-Expo-Firebase-Boilerplate-v2)ã«ã‚ã‚Šã¾ã™ã®ã§å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---
---
title: ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§æ›¸ã„ã¦ã„ãŸGatsbyã‚’MDXã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ
tags: [  ]
date: 2020-11-01
path: blog/2020-11-01
cover: ./img.png
excerpt: Switched Gatsby blog from .md to .mdx
keywords:
    - é–‹ç™º
    - Develop
    - React
    - Gatsby
    - Code
    - ã‚³ãƒ¼ãƒ‰
---
import { Link } from 'gatsby';
import AndroidIcon from '@material-ui/icons/Android';
import AppleIcon from '@material-ui/icons/Apple';

æœ¬é¡Œã«å…¥ã‚‹å‰ã«<Link to="/blog/2020-10-30">å‰å›</Link>ã®è£œè¶³ã€‚

å‰å›ã€è¨˜äº‹ã®æœ€å¾Œã«å‰å¾Œã®è¨˜äº‹ã®ãƒªãƒ³ã‚¯ã‚’å…¥ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸãŒã€æœ€æ–°ã¨æœ€å¤ã®è¨˜äº‹ã§ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€ãŒãŠã‹ã—ã‹ã£ãŸã®ã§ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’ç›´ã—ã¾ã—ãŸã€‚ã¤ã„ã§ã«ãƒ–ãƒ­ã‚°ä¸€è¦§ã¸ã®ãƒªãƒ³ã‚¯ã‚‚è¿½åŠ ã—ã¾ã—ãŸã€‚

`å¤‰æ›´å¾Œã®ã‚³ãƒ¼ãƒ‰`

```javascript
import React from 'react';
import { Link } from 'gatsby';
import { Row, Col } from 'antd';

const PostNav = ({prev, next}) => (
  <div>
    <Row>
      <Col span={12}>
        {prev && (
          <div>
            <span>æ¬¡ã®è¨˜äº‹</span>
            <br/>
            <Link to={`/${prev.frontmatter.path}`}>
              {prev.frontmatter.title}
            </Link>
          </div>
        )}
      </Col>
      <Col span={12}>
        {next && (
          <div>
            <span>å‰ã®è¨˜äº‹</span>
            <br/>
            <Link to={`/${next.frontmatter.path}`}>
              {next.frontmatter.title}
            </Link>
          </div>
        )}
      </Col>
    </Row>
    <br/>
    <Row alignItems="center" justify="center">
      <Col>
        <Link to="/blog">
          ãƒ–ãƒ­ã‚°ãƒˆãƒƒãƒ—
        </Link>
      </Col>
    </Row>
  </div>
);

export default PostNav;

```

### ç´ ã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§æ›¸ã„ã¦ã„ãŸã“ã®ãƒ–ãƒ­ã‚°ã‚’MDXã«å¤‰æ›´ã—ã¾ã—ãŸ

ã“ã‚Œã¾ã§ã“ã®ã‚µã‚¤ãƒˆã®ãƒ–ãƒ­ã‚°ãƒã‚¹ãƒˆã¯.mdã§æ›¸ã„ã¦ã„ãŸã®ã§ã™ãŒã€ã›ã£ã‹ã"**blazing fast**ğŸ”¥"ãªGatsbyãªã®ã§ã€ãƒã‚¹ãƒˆå†…ã§ã‚‚```<Link>```ã‚¿ã‚°ã‚’ä½¿ã„ãŸãã¦MDXã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚**MDX**ã¯ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ä¸­ã§JavaScriptã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«æ‹¡å¼µã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚

è¨˜äº‹å†…ã«JavaScriptã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§

```javascript
import { Link } from 'gatsby';
```
```html
æœ¬é¡Œã«å…¥ã‚‹å‰ã«<Link to="/blog/2020-10-30">å‰å›</Link>ã®è£œè¶³ã€‚
```
ã¨ã‹æ›¸ãã¨ã¡ã‚ƒã‚“ã¨æŠ•ç¨¿å†…ã§ãã®JavaScriptãŒå‹•ãã¾ã™ã€‚

ãªã®ã§
```javascript
import AndroidIcon from '@material-ui/icons/Android';
import AppleIcon from '@material-ui/icons/Apple';
```
ã¨æ›¸ãã¨è¨˜äº‹å†…ã§

<AndroidIcon/>
<AppleIcon/>

ãªã‚“ã‹ã®Material IconãŒä½¿ãˆãŸã‚Šã—ã¾ã™ã€‚

Material Iconã‚’ä½¿ã†ã“ã¨ã¯ãªã„ã¨æ€ã„ã¾ã™ãŒã€‚Gatsbyã®çˆ†é€Ÿã®è¦ã§ã‚ã‚‹`<Link>`ã‚¿ã‚°ã‚’æŠ•ç¨¿å†…ã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ãŸã‹ã£ãŸã®ã§ã™ã€‚å…¬å¼è‡ªã‚‰"**blazing fast**ğŸ”¥"ãªã‚“ã¦è¨€ã£ã¡ã‚ƒã†ãã‚‰ã„ã€ç¢ºã‹ã«ãƒšãƒ¼ã‚¸é·ç§»ãŒçŒ›çƒˆã«é€Ÿã„ã§ã™ã‹ã‚‰ã€‚

**`ä»Šå›ã‚„ã£ãŸã“ã¨`**

ã¾ãšã¯å…¬å¼ãƒšãƒ¼ã‚¸ã®æŒ‡ç¤ºé€šã‚ŠMDXãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚

```shell
yarn add gatsby-plugin-mdx @mdx-js/mdx @mdx-js/react
```

### **gatsby-config.plugins.js**ã‚’å¤‰æ›´

`å¤‰æ›´å‰`
```javascript
{
    resolve: 'gatsby-transformer-remark',
    options: {
      plugins: [
        {
          resolve: 'gatsby-remark-images',
          options: {
            maxWidth: 650,
            quality: 80,
            showCaptions: true,
            linkImagesToOriginal: true,
          },
        },
        {
          resolve: 'gatsby-remark-external-links',
          options: {
            rel: 'nofollow',
          },
        },
        'gatsby-remark-prismjs',
      ],
    },
  },
  ```
  `å¤‰æ›´å¾Œ`
  ```javascript
  {
    resolve: `gatsby-plugin-mdx`,
    options: {
        gatsbyRemarkPlugins: [
            {
                resolve: `gatsby-remark-images`,
                options: {
                  maxWidth: 650,
                  quality: 80,
                  showCaptions: true,
                  linkImagesToOriginal: true,
                },
            },
            {
                resolve: "gatsby-remark-external-links",
                options: {
                  target: "_blank",
                  rel: "nofollow"
                },
            },
            'gatsby-remark-prismjs',
        ],
    },
  },
  ```

  ### **gatsby-node.js**ã‚’å¤‰æ›´

  `å¤‰æ›´å‰`
```javascript
const path = require('path');
const config = require('./config');
const utils = require('./src/utils/pageUtils');

exports.createPages = ({ actions, graphql }) => {
  const { createPage } = actions;

  return graphql(`
    {
      allMarkdownRemark(sort: {order: DESC, fields: [frontmatter___date]}) {
        edges {
          node {
            frontmatter {
              path
              tags
            }
            fileAbsolutePath
          }
          next {
            frontmatter { title path }
          }
          prev: previous {
            frontmatter { title path }
          }
        }
      }
    }    
  `).then((result) => {
    if (result.errors) return Promise.reject(result.errors);

    const { allMarkdownRemark } = result.data;

    /* Post pages */
    allMarkdownRemark.edges.forEach(({ node }) => {
      // Check path prefix of post
      if (node.frontmatter.path.indexOf(config.pages.blog) !== 0) {
        // eslint-disable-next-line no-throw-literal
        throw `Invalid path prefix: ${node.frontmatter.path}`;
      }

      createPage({
        path: node.frontmatter.path,
        component: path.resolve('src/templates/post/post.jsx'),
        context: {
          postPath: node.frontmatter.path,
          translations: utils.getRelatedTranslations(node, allMarkdownRemark.edges),
        },
      });
    });
    const regexForIndex = /index\.md$/;
    // Posts in default language, excluded the translated versions
    const defaultPosts = allMarkdownRemark.edges
      .filter(({ node: { fileAbsolutePath } }) => fileAbsolutePath.match(regexForIndex));

    /* Tag pages */
    const allTags = [];
    defaultPosts.forEach(({ node }) => {
      node.frontmatter.tags.forEach((tag) => {
        if (allTags.indexOf(tag) === -1) allTags.push(tag);
      });
    });

    allTags
      .forEach((tag) => {
        createPage({
          path: utils.resolvePageUrl(config.pages.tag, tag),
          component: path.resolve('src/templates/tags/index.jsx'),
          context: {
            tag,
          },
        });
      });

      allMarkdownRemark.edges.forEach(({node, next, prev}) => {
        const {frontmatter} = node
      
        createPage({
          path: `/${frontmatter.path}`,
          component: path.resolve('src/templates/post/post.jsx'),
          context: {
            id: node.id,
            postPath: frontmatter.path,
            next,
            prev,
          },
        })
      });

    return 1;
  });
};
```

`å¤‰æ›´å¾Œ`
```javascript
const path = require('path');
const config = require('./config');
const utils = require('./src/utils/pageUtils');

exports.createPages = ({ actions, graphql }) => {
  const { createPage } = actions;

  return graphql(`
    {
      allMdx(sort: {order: DESC, fields: [frontmatter___date]}) {
        edges {
          node {
            frontmatter {
              path
              tags
            }
            fileAbsolutePath
          }
          next {
            frontmatter { title path }
          }
          prev: previous {
            frontmatter { title path }
          }
        }
      }
    }    
  `).then((result) => {
    if (result.errors) return Promise.reject(result.errors);

    const { allMdx } = result.data;

    /* Post pages */
    allMdx.edges.forEach(({ node }) => {
      // Check path prefix of post
      if (node.frontmatter.path.indexOf(config.pages.blog) !== 0) {
        // eslint-disable-next-line no-throw-literal
        throw `Invalid path prefix: ${node.frontmatter.path}`;
      }

      createPage({
        path: node.frontmatter.path,
        component: path.resolve('src/templates/post/post.jsx'),
        context: {
          postPath: node.frontmatter.path,
          translations: utils.getRelatedTranslations(node, allMdx.edges),
        },
      });
    });
    const regexForIndex = /index\.mdx/;
    // Posts in default language, excluded the translated versions
    const defaultPosts = allMdx.edges
      .filter(({ node: { fileAbsolutePath } }) => fileAbsolutePath.match(regexForIndex));

    /* Tag pages */
    const allTags = [];
    defaultPosts.forEach(({ node }) => {
      node.frontmatter.tags.forEach((tag) => {
        if (allTags.indexOf(tag) === -1) allTags.push(tag);
      });
    });

    allTags
      .forEach((tag) => {
        createPage({
          path: utils.resolvePageUrl(config.pages.tag, tag),
          component: path.resolve('src/templates/tags/index.jsx'),
          context: {
            tag,
          },
        });
      });

      allMdx.edges.forEach(({node, next, prev}) => {
        const {frontmatter} = node
      
        createPage({
          path: `/${frontmatter.path}`,
          component: path.resolve('src/templates/post/post.jsx'),
          context: {
            id: node.id,
            postPath: frontmatter.path,
            next,
            prev,
          },
        })
      });

    return 1;
  });
};
```

å…¨éƒ¨è¼‰ã›ãŸã®ã§å†—é•·ã«ãªã‚Šã¾ã—ãŸãŒã€`allMarkdownRemark`ã‚’`allMDX`ã«ã€`index\.md$/;`ã‚’`index\.mdx/;`ã«å¤‰æ›´ã—ãŸã ã‘ã§ã™ã€‚

### æŠ•ç¨¿ä¸€è¦§ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å¤‰æ›´

**src/pages/blog/index.jsx**

`å¤‰æ›´å‰`
```javascript
data.allMarkdownRemark && data.allMarkdownRemark.edges.map((val, key) => (
```
```javascript
Blog.propTypes = {
  data: PropTypes.shape({
    allMarkdownRemark: PropTypes.shape({
      edges: PropTypes.arrayOf(PropTypes.object.isRequired).isRequired,
    }).isRequired,
  }).isRequired,
};
```
```javascript
export const query = graphql`
  {
    allMarkdownRemark(
      sort: { fields: [frontmatter___date], order: DESC }
      filter: { fileAbsolutePath: { regex: "/index.md$/" } }
    ) {
```

`å¤‰æ›´å¾Œ`
```javascript
data.allMdx && data.allMdx.edges.map((val, key) => (
```
```javascript
Blog.propTypes = {
  data: PropTypes.shape({
    allMdx: PropTypes.shape({
      edges: PropTypes.arrayOf(PropTypes.object.isRequired).isRequired,
    }).isRequired,
  }).isRequired,
};
```
```javascript
export const query = graphql`
  {
    allMdx(
      sort: { fields: [frontmatter___date], order: DESC }
      filter: { fileAbsolutePath: { regex: "/index.mdx/" } }
    ) {
```

ã“ã‚Œã‚‚ã€`allMarkdownRemark`ã‚’`allMDX`ã«ã€`index\.md$/;`ã‚’`index\.mdx/;`ã«å¤‰æ›´ã—ãŸã ã‘ã§ã™ã€‚

### è¨˜äº‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å¤‰æ›´

**src/templates/post/post.jsx**

MDXãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```javascript
import { MDXRenderer } from "gatsby-plugin-mdx"
import { MDXProvider } from "@mdx-js/react"
```

`å¤‰æ›´å‰`
```javascript
const Post = ({ data, pageContext }) => {
  const { html, frontmatter } = data.markdownRemark;
  const {
    title, cover: { childImageSharp: { fluid } }, excerpt, path, date,
  } = frontmatter;
```

`å¤‰æ›´å¾Œ`
```javascript
const Post = ({ data, pageContext }) => {
  const { body, frontmatter } = data.mdx;
  const {
    title, cover: { childImageSharp: { fluid } }, excerpt, path, date,
  } = frontmatter;
```

æœ¬æ–‡è¡¨ç¤ºç®‡æ‰€ã‚’MDXç”¨ã«å¤‰æ›´

`å¤‰æ›´å‰`
```javascript
<article className={style.blogArticle} dangerouslySetInnerHTML={{ __html: html }} />
```

`å¤‰æ›´å¾Œ`
```javascript
<MDXProvider components={style.blogArticle}>
    <MDXRenderer>{body}</MDXRenderer>
</MDXProvider>
```

graphqléƒ¨åˆ†

`å¤‰æ›´å‰`
```javascript
export const pageQuery = graphql`
  query($postPath: String!) {
    markdownRemark(frontmatter: { path: { eq: $postPath } }) {
      html
      timeToRead
      frontmatter {
        title
        date(formatString: "YYYY-MM-DD")
        tags
        path
        excerpt
        cover {
          childImageSharp {
            fluid(maxWidth: 1000) {
              ...GatsbyImageSharpFluid_tracedSVG
            }
          }
        }
      }
    }
    allMarkdownRemark(
      filter: {
        frontmatter: { path: { ne: $postPath } }
        fileAbsolutePath: { regex: "/index.md$/" }
```

`å¤‰æ›´å¾Œ`
```javascript
export const pageQuery = graphql`
  query($postPath: String!) {
    mdx(frontmatter: { path: { eq: $postPath } }) {
      timeToRead
      body
      frontmatter {
        title
        date(formatString: "YYYY-MM-DD")
        tags
        path
        excerpt
        cover {
          childImageSharp {
            fluid(maxWidth: 1000) {
              ...GatsbyImageSharpFluid_tracedSVG
            }
          }
        }
      }
    }
    allMdx(
      filter: {
        frontmatter: { path: { ne: $postPath } }
        fileAbsolutePath: { regex: "/index.mdx/" }
```

ã“ã‚Œã‚‚ã€`allMarkdownRemark`ã‚’`allMDX`ã«ã€`index\.md$/;`ã‚’`index\.mdx/;`ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚ã‚ã¨ã¯æœ¬æ–‡è¡¨ç¤ºç”¨ã®`html`ã‚’`body`ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

ã‚ã¨ã¯`index.md`ã§æ›¸ã„ã¦ããŸå„è¨˜äº‹ã‚’`index.mdx`ã«ãƒªãƒãƒ¼ãƒ ã—ã¾ã™ã€‚

ä»¥ä¸Šã§ã™ã€‚

---


`gatsby plugin mdx`ã§ã‚°ã‚°ã£ã¦å‡ºã¦ãã‚‹æ—¥æœ¬èªè¨˜äº‹ã‚’èª­ã‚€ã¨é›£ã—ãã†ãªæ„Ÿã˜ã§ã™ãŒã€ã‚„ã£ã¦ã¿ã‚‹ã¨æ„å¤–ã¨ã‚ã£ã•ã‚Šã§ãã¾ã—ãŸã€‚

è‹¦åŠ´ã—ãŸã¨ã“ã‚ã¯**gatsby-config.plugins.js**ã§`gatsby-remark-prismjs`ã‚’å…¥ã‚Œå¿˜ã‚Œã¦ã¦ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ãŒå½“ãŸã‚‰ãªãã¦æ‚©ã‚“ã ãã‚‰ã„ã§ã—ãŸã€‚

### GatsbyJSã¯ã„ã„ã!!!

---